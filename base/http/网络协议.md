#### HTTP三次握手
<image src="https://github.com/minminzhang/phper/blob/main/base/http/images/WechatIMG45494.png" style="width:70%;"/>

为什么在建立连接的时候需要有三次握手？第三次握手有什么意义？
```
假如建立连接只需要2次握手，那么客户端发出请求连接后，服务端一旦收到请求连接消息便会回复确认请求，并开始建立连接，
但是这个请求连接有可能只是因为网络延迟而迟到的一个无效连接请求，这样服务端发出的确认请求消息并不会被客户端正确处理，
最终导致服务端一直保持连接，造成资源浪费。

加上第3次握手，如果服务端在发出确认连接的消息后，一直没有收到客户端的确认消息，
则会在再次重发几次消息后发送RST数据包强制关闭连接
```

#### HTTP四次挥手
<image src="https://github.com/minminzhang/phper/blob/main/base/http/images/WechatIMG45496.png" style="width:70%;"/>

4次挥手的流程如下：
- 首先，客户端发送带有 FIN=1 标志的报文段，用于表明没有消息想要发送（此时还可以继续接收来自服务端的消息），请求释放连接。
- 其次，服务端发送带有 ACK=1 标志的报文段，用于表明已经收到客户端的释放连接请求，开始检查自身是否还有消息想要发送。
- 其次，服务端发送带有 FIN=1 标志的报文段，用于表明没有消息想要发送，确认释放连接。
- 最后，客户端发送带有 ACK=1 标志的报文段，用于表明已经收到服务端的释放连接确认，等待 2MSL 后正式关闭连接。

#### HTTPS
HTTPS 是在HTTP的基础上，使用SSL/TLS来加密报文，对窃听和中间人攻击提供合理的防护。

`TLS：传输层安全性协议（Transport Layer Security）(前身是SSL：Secure Sockets Layer即安全套接层)`

##### HTTPS的通信过程
总的可以分为三大阶段：
1，TCP的3次握手
2，TLS的连接
3，HTTP请求和响应

<image src="https://github.com/minminzhang/phper/blob/main/base/http/images/https.jpg" style="width:70%;"/>

```
对称加密：加密和解密使用同一个密钥
常见的对称加密方式有：DES、AES、3DES
优点：算法简单，加解密容易，效率高，执行速度快
缺点：相对来说不安全，只有一把钥匙，密文如果被拦截，密钥被劫持，信息很容易被破译
```

```
非对称加密：加密和解密使用不同的密钥，一把作为公开的公钥，另一把作为私钥，公钥加密的信息只有私钥才能解密。
私钥加密的信息，只有公钥可以解密。
常见的非对称加密方式有：RSA、ECC
优点：安全，即使密文和公钥被拦截，但是由于无法获取到私钥，也就无法破译到密文。
缺点：加密算法复杂，安全性依赖算法和密钥，且加密解密效率很低。
```
用非对称加密传输对称加密的密钥

HTTP TLS的功能实质就是：如何协商出安全的对称加密秘钥，以利用次密钥进行后续通讯的过程。


1，HTTPS建立请求前，先发数字证书

  1.身份验证，拿到正确的公钥，是请求的正确的服务器。
  
  2.完整性验证，确保公钥没有被篡改。
  
2，非对称加密（RSA），拿到服务器公钥后，浏览器用这个公钥加密出对称密钥发送给服务器，服务器用私钥解密，中间人没有私钥获取不到信息

3，通信双方使用对称密钥加密信息传送，速度比RSA要快，中间人不知道对称密钥无法解密信息。


#### HTTPS的工作原理：

1，客户端发起HTTPS请求：就是用户在浏览器里输入一个https网址，然后连接到server的443端口。

2，服务端的配置：采用HTTPS协议的服务器必须要有一套数字证书，这套证书其实就是一对公钥和私钥

3，传送证书：这个证书其实就是公钥，包含了很多信息，如证书的颁发机构、过期时间等等。

4，客户端解析证书：这部分工作有客户端的TLS来完成，首先会验证公钥是否有效，比如颁发机构、过期时间等等。

  如果发现异常，则会弹出一个警告框，提示证书有问题；
  
  如果证书没问题，那么就生成一个随机值，然后用证书对该随机值进行加密，这样除非有私钥，不然看不到随机值。
  
5，传输加密信息：传送用证书加密后的随机值，目的是让服务端得到这个随机值，以后客户端和服务端的通信就可以通过这个随机值进行加密和解密了。

6，服务端解密信息：服务端解密之后，获取到客户端传过来的随机值（对称加密私钥），然后把内容通过该值进行对称加密。

7，传输加密后的信息：服务端用私钥加密过的信息，在客户端可以被还原

8，客户端解密信息：客户端用之前生成的私钥，解密服务端传过来的信息，获取解密后的内容

<image src="https://github.com/minminzhang/phper/blob/main/base/http/images/https-intro.png" style="width:70%;"/>






http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html

https://www.runoob.com/w3cnote/http-vs-https.html


















